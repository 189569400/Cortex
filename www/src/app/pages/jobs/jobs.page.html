<section class="content-header">
  <h1>Jobs</h1>
</section>
<section class="jobs-page content">
  <form ng-submit="$ctrl.applyFilters()">
    <div class="row">
    <div class="col-md-3">
      <div class="box box-primary">
        <div class="box-header with-border">
          <h3 class="box-title">Search</h3>
          <div class="box-tools">
            <button type="button" class="btn btn-box-tool" ng-click="$ctrl.clearFilter('search')">
              <i class="fa fa-eraser"></i>
            </button>
          </div>
        </div>
        <div class="box-body">
          <div class="input-group form-group">
            <input type="text" class="form-control" placeholder="Search for observable data" ng-model="$ctrl.filters.search">
            <div class="input-group-btn">
              <button class="btn btn-default" type="submit">Search</button>            
            </div>
          </div>
        </div>
      </div>      

      <div class="box box-primary">
        <div class="box-header with-border">
          <h3 class="box-title">Data Types</h3>
          <div class="box-tools">
            <button type="button" class="btn btn-box-tool" ng-click="$ctrl.clearFilter('dataType')">
              <i class="fa fa-eraser"></i>
            </button>
          </div>
        </div>
        <div class="box-body">
          <multiselect ng-model="$ctrl.filters.dataType" options="$ctrl.datatypes" placeholder="Salect data types"
            classes-btn="'btn-primary btn-block'" show-select-all="true" show-unselect-all="true">
          </multiselect>
          <ul class="nav nav-pills nav-stacked">
            <li ng-repeat="key in $ctrl.filters.dataType">
              <a href>{{key}}</a>
            </li>
          </ul>
        </div>
      </div>
      <div class="box box-primary">
        <div class="box-header with-border">
          <h3 class="box-title">Analyzers</h3>
          <div class="box-tools">
            <button type="button" class="btn btn-box-tool" ng-click="$ctrl.clearFilter('analyzer')">
              <i class="fa fa-eraser"></i>
            </button>
          </div>
        </div>
        <div class="box-body">
          <multiselect ng-model="$ctrl.filters.analyzer" options="$ctrl.analyzers" id-prop="id" display-prop="name" placeholder="Salect analyzers"
            classes-btn="'btn-primary btn-block'" show-select-all="true" show-unselect-all="true">
          </multiselect>
          <ul class="nav nav-pills nav-stacked">
            <li ng-repeat="analyzer in $ctrl.filters.analyzer">
              <a class="text-ellipsis" href>{{analyzer.name}}</a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="col-md-9">
      <div class="box box-primary">
        <div class="box-header">
          <h3 class="box-title">List of existing jobs</h3>
          <div class="box-tools btn-toolbar">
            <ul ng-show="$ctrl.pagination.total > $ctrl.pagination.pageSize" uib-pagination total-items="$ctrl.pagination.total" ng-change="$ctrl.pageChanged()" ng-model="$ctrl.pagination.current" class="pagination-sm"
              boundary-links="true" items-per-page="$ctrl.pagination.pageSize" max-size="5" rotate="false"></ul>            
            <select class="ml-xs form-control input-sm pull-right" ng-model="$ctrl.pagination.pageSize" ng-change="$ctrl.pageChanged()" ng-options="v for v in [10, 50, 100, 1000]"></select>
          </div>
        </div>
        <div class="box-body no-padding">
          <table class="table table-striped">
            <thead>
              <tr>
                <th width="80">Status</th>
                <th width="200">Analyzer</th>
                <th width="150">Date</th>
                <th>Artifact</th>
                <th width="150" class="text-center">Data Type</th>
                <th width="60"></th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="job in $ctrl.jobs"
                ng-init="isFile = job.dataType ==='file'">
                <td>
                  <span class="label label-default" ng-class="{
                                            'Success': 'label-success',
                                            'InProgress': 'label-warning',
                                            'Failure': 'label-danger'}[job.status]">{{job.status}}</span>
                </td>
                <td>
                  {{job.analyzerName}}
                </td>
                <td am-time-ago="job.createdAt"></td>
                <td class="wrap">
                  {{(isFile ? job.filename : job.data) | fang}}
                </td>
                <td class="text-center">
                  <span class="label label-default">{{job.dataType}}</span>
                </td>
                <td>
                  <a ui-sref="main.job-report({id: job.id})" tooltip="View Report">
                    <i class="fa fa-search fa-lg text-primary"></i>
                  </a>
                  <a href ng-click="$ctrl.remove(job.id)" tooltip="Remove" require-roles roles="['admin', 'write']">
                    <i class="fa fa-times fa-lg text-danger"></i>
                  </a>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="box-footer clearfix">
          <div class="box-tools btn-toolbar pull-right">
            <ul ng-show="$ctrl.pagination.total > $ctrl.pagination.pageSize" uib-pagination total-items="$ctrl.pagination.total" ng-change="$ctrl.pageChanged()" ng-model="$ctrl.pagination.current"
              class="pagination-sm" boundary-links="true" items-per-page="$ctrl.pagination.pageSize" max-size="5" rotate="false"></ul>
            <select class="ml-xs form-control input-sm pull-right " ng-model="$ctrl.pagination.pageSize" ng-change="$ctrl.pageChanged()" ng-options="v for v in [10, 50, 100, 1000]"></select>
          </div>
        </div>
      </div>
    </div>
  </div>
  </form>
</section>
<!-- /.content -->